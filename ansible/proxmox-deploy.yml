---
# =============================================================================
# proxmox-deploy.yml â€” Deploy Talos cluster on Proxmox
#
# Usage:
#   cd ansible
#   ansible-playbook proxmox-deploy.yml -e env=../environments/proxmox-homelab
# =============================================================================

# --- Load config, validate, add Proxmox host ---
- name: Load and validate Proxmox config
  hosts: localhost
  gather_facts: false
  tasks:
    - ansible.builtin.include_tasks: tasks/load-config.yml
    - ansible.builtin.include_tasks: tasks/validate-proxmox.yml

# --- Create VMs, bootstrap Talos, fix boot order, install Cilium ---
- name: Deploy Talos cluster
  hosts: proxmox_hosts
  gather_facts: false
  roles:
    - proxmox_vms
    - talos_bootstrap
    - proxmox_post_install
    - cilium
