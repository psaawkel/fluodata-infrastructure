---
# =============================================================================
# vps-argocd.yml â€” Install/upgrade ArgoCD on an existing VPS cluster
#
# Usage:
#   cd ansible
#   ansible-playbook vps-argocd.yml -e env=../environments/vps-ovh-test1
#
# Prerequisites:
#   1. Cluster already bootstrapped (vps-deploy.yml completed)
#   2. kubeconfig exists in env_dir
#   3. age key at ~/.config/sops/age/keys.txt
# =============================================================================

- name: Install ArgoCD on VPS cluster
  hosts: localhost
  gather_facts: false
  pre_tasks:
    - ansible.builtin.include_tasks: tasks/load-config.yml
    - ansible.builtin.include_tasks: tasks/validate-vps.yml
    - name: Set kubeconfig path
      ansible.builtin.set_fact:
        kubeconfig_path: "{{ env_dir }}/kubeconfig"
  roles:
    - argocd
