# Control plane common patch
# - Disable default CNI (we use Cilium)
# - Disable kube-proxy (Cilium replaces it)
# - etcd advertised subnets
# - Kernel modules for Longhorn
# - Kubelet serving cert rotation
# - Network sysctls
cluster:
  network:
    cni:
      name: none
  proxy:
    disabled: true
{% if etcd_advertised_subnets is defined %}
  etcd:
    advertisedSubnets:
{% for subnet in etcd_advertised_subnets %}
      - {{ subnet }}
{% endfor %}
{% endif %}
machine:
  kernel:
    modules:
      - name: iscsi_tcp
      - name: dm_thin_pool
  kubelet:
    extraArgs:
      rotate-server-certificates: "true"
  sysctls:
    net.core.somaxconn: "65535"
    net.core.netdev_max_backlog: "4096"
  time:
    servers:
      - time.cloudflare.com
      - pool.ntp.org
