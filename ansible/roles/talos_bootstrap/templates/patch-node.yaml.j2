# Per-node patch: static IP, routes, nameservers, VIP (CP only), install image
# NO hostname â€” let DHCP or Talos auto-generate handle it
machine:
  network:
    interfaces:
      - deviceSelector:
          physical: true
        addresses:
          - {{ item.ip }}/{{ vm_subnet_mask }}
{% if item.name in controlplane_nodes | map(attribute='name') | list and cluster_vip is defined %}
        vip:
          ip: {{ cluster_vip }}
{% endif %}
        routes:
          - network: 0.0.0.0/0
            gateway: {{ vm_gateway }}
    nameservers:
{% for ns in vm_nameservers %}
      - {{ ns }}
{% endfor %}
  install:
    disk: {{ talos_install_disk | default('/dev/sda') }}
    image: {{ talos_install_image }}
