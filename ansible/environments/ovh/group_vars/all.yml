# =============================================================================
# OVH VPS environment variables
#
# 3x VPS (8 vCPU, 24 GB RAM, 200 GB NVMe) — combined CP+worker nodes
# Talos installed via rescue mode + dd
# All talosctl/kubectl/helm commands run locally (nodes have public IPs)
# =============================================================================

# --- Talos ---
talos_version: v1.12.4
talos_schematic_id: e187c9b90f773cd8c84e5a3265c5554ee787b2fe67b508d9f955e90e7ae8c96c
# OVH VPS: use metal (raw) image for dd install, not nocloud ISO
talos_metal_image_url: "https://factory.talos.dev/image/{{ talos_schematic_id }}/{{ talos_version }}/metal-amd64.raw.xz"
talos_install_image: "factory.talos.dev/installer/{{ talos_schematic_id }}:{{ talos_version }}"
talos_install_disk: /dev/sda

# --- Cluster ---
cluster_name: fluodata
# VIP not used on OVH (no shared L2 for gratuitous ARP) — use first CP node IP
# cluster_vip is intentionally NOT defined; cluster_endpoint points to first CP
cluster_endpoint: "https://{{ controlplane_nodes[0].ip }}:6443"

# --- Directories ---
# talosctl runs locally (VPS nodes have public IPs)
talosctl_delegate_to: localhost
talos_work_dir: "{{ playbook_dir }}/../../talos"
talos_local_dir: "{{ playbook_dir }}/../../talos"

# --- Network ---
# OVH VPS: each node has a public IP + vRack private IP
# Public IPs are assigned by OVH, private IPs are on vRack subnet
# vm_gateway and vm_nameservers are for the Talos node network config
#
# NOTE: These MUST be updated with actual OVH-assigned values
vm_gateway: "REPLACE_WITH_OVH_GATEWAY"
vm_subnet_mask: 24
vm_nameservers:
  - 213.186.33.99    # OVH DNS
  - 1.1.1.1

# --- Node definitions ---
# All 3 nodes are combined controlplane + worker
# IPs must be updated with actual OVH VPS public IPs
controlplane_nodes:
  - name: node-0
    ip: "REPLACE_WITH_VPS_0_PUBLIC_IP"
  - name: node-1
    ip: "REPLACE_WITH_VPS_1_PUBLIC_IP"
  - name: node-2
    ip: "REPLACE_WITH_VPS_2_PUBLIC_IP"

# No dedicated workers — all nodes are combined CP+worker
worker_nodes: []

# Merged list for convenience
all_nodes: "{{ controlplane_nodes + worker_nodes }}"

# --- Cilium ---
cilium_version: "1.17.3"
