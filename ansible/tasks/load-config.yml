---
# tasks/load-config.yml â€” Load and validate environment config (common)
#
# Required variable: env (path to environment folder, passed via -e)
# Sets: env_dir (absolute path), plus all variables from config.yml

- name: Fail if env is not specified
  ansible.builtin.fail:
    msg: "Specify environment folder: -e env=../environments/<name>"
  when: env is not defined

- name: Resolve env_dir to absolute path
  ansible.builtin.set_fact:
    env_dir: "{{ (playbook_dir ~ '/' ~ env) | realpath }}"

- name: Check config.yml exists
  ansible.builtin.stat:
    path: "{{ env_dir }}/config.yml"
  register: _config_stat

- name: Fail if config.yml not found
  ansible.builtin.fail:
    msg: "config.yml not found in {{ env_dir }}"
  when: not _config_stat.stat.exists

- name: Load config.yml
  ansible.builtin.include_vars:
    file: "{{ env_dir }}/config.yml"
