---
# =============================================================================
# vps-deploy.yml â€” Bootstrap Talos cluster on VPS nodes + install Cilium
#
# Usage:
#   cd ansible
#   ansible-playbook vps-deploy.yml -e env=../environments/vps-ovh-test
#
# Prerequisites:
#   1. Talos written to disk (run vps-deploy-rescue.yml first, one-time)
#   2. VPS rebooted into normal boot mode (Talos running in maintenance mode)
#   3. talosctl, kubectl, helm installed locally
# =============================================================================

- name: Deploy Talos cluster on VPS
  hosts: localhost
  gather_facts: false
  pre_tasks:
    - ansible.builtin.include_tasks: tasks/load-config.yml
    - ansible.builtin.include_tasks: tasks/validate-vps.yml
  roles:
    - talos_generate
    - talos_bootstrap_vps
    - cilium
    - kubelet_cert_approver
