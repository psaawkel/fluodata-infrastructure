# Mosquitto configuration.
# - Both listeners require username/password authentication.
# - Listener on 1883: plain MQTT.
# - Listener on 8883: MQTTS with TLS termination using cert-manager certs.
apiVersion: v1
kind: ConfigMap
metadata:
  name: mosquitto-config
  namespace: mqtt
data:
  mosquitto.conf: |
    # --- Global ---
    per_listener_settings false
    persistence false
    log_dest stdout
    log_type all

    # --- Authentication ---
    password_file /mosquitto/passwd/passwd
    allow_anonymous false

    # --- Plain MQTT (port 1883) ---
    listener 1883
    protocol mqtt

    # --- MQTTS (port 8883) â€” TLS termination ---
    listener 8883
    protocol mqtt
    certfile /mosquitto/certs/tls.crt
    keyfile /mosquitto/certs/tls.key
