# Mosquitto configuration.
# - Listener on 1883: plain MQTT, no auth (add auth plugin/password_file as needed).
# - Listener on 8883: MQTTS with TLS termination using cert-manager certs.
apiVersion: v1
kind: ConfigMap
metadata:
  name: mosquitto-config
  namespace: mqtt
data:
  mosquitto.conf: |
    # --- Global ---
    per_listener_settings true
    persistence false
    log_dest stdout
    log_type all

    # --- Plain MQTT (port 1883) ---
    listener 1883
    protocol mqtt
    allow_anonymous true

    # --- MQTTS (port 8883) â€” TLS termination ---
    listener 8883
    protocol mqtt
    certfile /mosquitto/certs/tls.crt
    keyfile /mosquitto/certs/tls.key
    allow_anonymous true
