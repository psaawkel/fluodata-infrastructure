# Per-node patch: static IP, routes, nameservers
# NO hostname â€” dnsmasq handles it via DHCP (Talos v1.12.4 rejects hostname if DHCP sets one)
machine:
  network:
    interfaces:
      - deviceSelector:
          physical: true
        addresses:
          - {{ item.ip }}/{{ vm_subnet_mask }}
{% if item.name in controlplane_nodes | map(attribute='name') | list and cluster_vip is defined %}
        vip:
          ip: {{ cluster_vip }}
{% endif %}
        routes:
          - network: 0.0.0.0/0
            gateway: {{ vm_gateway }}
    nameservers:
{% for ns in vm_nameservers %}
      - {{ ns }}
{% endfor %}
  install:
    disk: /dev/sda
    image: {{ talos_install_image }}
